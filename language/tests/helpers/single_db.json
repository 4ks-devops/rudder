{
  "type": "ncf_technique",
  "version": 2,
  "data": {
    "id": "Single_database",
    "description": "",
    "name": "Single database",
    "version": "1.0",
    "parameter": [
      {
        "id": "e40aad89-b73c-4a03-b520-ae2114e5be3c",
        "name": "db_name",
        "description": ""
      },
      {
        "id": "854e604d-effc-4561-aa3d-7580ebea2024",
        "name": "db_user",
        "description": ""
      }
    ],
    "category": "ncf_techniques",
    "calls": [
      {
        "parameters": [
          {
            "name": "name",
            "value": "mysql-server",
            "$errors": []
          },
          {
            "name": "version",
            "value": "",
            "$errors": []
          },
          {
            "name": "architecture",
            "value": "",
            "$errors": []
          },
          {
            "name": "provider",
            "value": "",
            "$errors": []
          }
        ],
        "condition": "any",
        "method": "package_present",
        "component": "Package present"
      },
      {
        "parameters": [
          {
            "name": "service_name",
            "value": "mysql",
            "$errors": []
          }
        ],
        "condition": "any",
        "method": "service_enabled",
        "component": "Service enabled at boot"
      },
      {
        "parameters": [
          {
            "name": "service_name",
            "value": "mysql",
            "$errors": []
          }
        ],
        "condition": "any",
        "method": "service_started",
        "component": "Service started"
      },
      {
        "parameters": [
          {
            "name": "condition",
            "value": "${db_name}_present",
            "$errors": []
          },
          {
            "name": "command",
            "value": "echo \"\" | mysql ${db_name}",
            "$errors": []
          },
          {
            "name": "true_codes",
            "value": "0",
            "$errors": []
          },
          {
            "name": "false_codes",
            "value": "1",
            "$errors": []
          }
        ],
        "condition": "any",
        "method": "condition_from_command",
        "component": "Condition from command"
      },
      {
        "parameters": [
          {
            "name": "command",
            "value": "echo \"CREATE DATABASE ${db_name}\" | mysql mysql",
            "$errors": []
          }
        ],
        "condition": "any.(${db_name}_present_false)",
        "method": "command_execution",
        "component": "Command execution"
      },
      {
        "parameters": [
          {
            "name": "variable_prefix",
            "value": "database",
            "$errors": []
          },
          {
            "name": "variable_name",
            "value": "secret",
            "$errors": []
          },
          {
            "name": "value",
            "value": "{ \"password\": \"secret\" }",
            "$errors": []
          }
        ],
        "condition": "any",
        "method": "variable_dict",
        "component": "Variable from Vault"
      },
      {
        "parameters": [
          {
            "name": "command",
            "value": "echo \"GRANT ALL ON ${db_name}.* TO '${db_user}'@% IDENTIFIED BY '${database.secret[password]}'\" | mysql mysql",
            "$errors": []
          }
        ],
        "condition": "any.(${db_name}_present_false)",
        "method": "command_execution",
        "component": "Command execution"
      }
    ]
  }
}

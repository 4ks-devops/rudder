<VirtualHost *:80>
  ServerAdmin webmaster@localhost

  # Logs
  LogLevel warn
  CustomLog /var/log/rudder/apache2/access.log combined
  ErrorLog /var/log/rudder/apache2/error.log

  Include /opt/rudder/etc/rudder-apache-*-common.conf
  IncludeOptional /opt/rudder/etc/rudder-apache-*-nossl.conf
</VirtualHost>

<VirtualHost *:443>
  ServerAdmin webmaster@localhost

  # Logs
  LogLevel warn
  CustomLog /var/log/rudder/apache2/access.log combined
  ErrorLog /var/log/rudder/apache2/error.log

  SSLEngine on
  # Key/Certificate used by the server for nodes communication
  SSLCertificateFile     /opt/rudder/etc/ssl/agent.cert
  SSLCertificateKeyFile  /var/rudder/cfengine-community/ppkeys/localhost.priv
  #Lines below where taken from https://ssl-config.mozilla.org/#server=apache&version=2.4.23&config=intermediate&openssl=1.0.2p&hsts=false&ocsp=false&guideline=5.6
  #Based on the oldest version of apache/openssl available in the Rudder server supported OS, in this case taken from a SLES12 SP4
  SSLProtocol             all -SSLv3 -TLSv1 -TLSv1.1
  SSLCipherSuite          ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
  SSLHonorCipherOrder     off
  SSLSessionTickets       off

  # Include Rudder common vhost definitions
  Include /opt/rudder/etc/rudder-apache-*-common.conf
  IncludeOptional /opt/rudder/etc/rudder-apache-*-ssl.conf
</VirtualHost>

# To use a different certificate and configuration for Web/API access
# uncomment and modify this virtual host.
#
# <VirtualHost *:443>
#   ServerAdmin webmaster@localhost
#
#   ServerName rudder.example.com
#
#   <Location "/">
#     Require all denied
#   </Location>
#
#   # Web UI
#   <Location "/rudder/secure">
#     Require all granted
#   </Location>
#   # Login page
#   <Location "/rudder/index.html">
#     Require all granted
#   </Location>
#   # API
#   <Location "/rudder/api">
#     Require all granted
#   </Location>
#
#   # Logs
#   LogLevel warn
#   CustomLog /var/log/rudder/apache2/access.log combined
#   ErrorLog /var/log/rudder/apache2/error.log
#
#   SSLEngine on
#   SSLCertificateFile    /etc/letsencrypt/live/example.com/cert.pem
#   SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem
#   SSLCertificateChainFile /etc/letsencrypt/live/example.com/fullchain.pem
#
#   # Include Rudder common vhost definitions
#   Include /opt/rudder/etc/rudder-apache-*-common.conf
#   IncludeOptional /opt/rudder/etc/rudder-apache-*-ssl.conf
# </VirtualHost>
